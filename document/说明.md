# 变量与数据类型详解

## 1. 变量存储机制

### 1.1 全局变量
- **存储位置**：`.data` 段
- **特点**：完成变量命名、内存分配和变量赋值

### 1.2 局部变量
- **存储位置**：相对于 BP 的偏移地址放在 `.text` 段（代码段）
- **实际存储**：变量实际存在堆栈之中
- **赋值方式**：在代码段中完成变量的赋值

### 1.3 静态局部变量（特殊情况）
- **存储位置**：`.data` 段
- **特点**：不会存在 `.text` 段，也不在栈中分配内存

### 1.4 全局常量变量
- **定义示例**：`const int c`
- **特点**：
  - 不会在 `.data` 段进行变量定义和内存分配
  - 不会在 `.text` 段进行变量定义和内存分配

## 2. 内存分配规则

### 2.1 变量分配顺序
- **规则**：在 C 语言中，先定义的变量会放在高字节（相对于后定义的变量）
- **适用范围**：无论是在 `.data` 段还是在 `.text` 段都遵循此规则
- **注意**：反汇编结果中的偏移量都是负值
  - `VAR_8` 对应偏移量 `-8h`
  - `VAR_14` 对应偏移量 `-14h`

## 3. 函数调用时的变量处理

### 3.1 printf 函数调用局部变量
- **入栈顺序**：从右向左的变量依次入栈

### 3.2 常量与变量的调用区别
- **调用常量时**：常量直接入栈（`push` 立即数）
- **调用变量时**：
  1. 先将变量 `mov` 到寄存器里面
  2. 然后 `push` 寄存器
  3. 变量既可能在 `.data` 段，也可能在堆栈里

## 4. 基本数据类型复习

### 4.1 有符号数与无符号数
- **内存表示**：无符号数 `0xFFFFFFFF` 和有符号数 `-1` 是一样的
- **类型对应**：`int` 和 `unsigned int` 在汇编中都是双字类型

### 4.2 bool 类型与 char 类型
- **内存表示**：对应的都是字节类型
- **特殊值**：`bool` 类型的变量等于 `false`，对应的就是 `0xFFh`，相当于 `char` 类型的变量等于 `-1`

## 5. 指针、数组、字符串详解

### 5.1 数组内存分配
- **分配规则**：从后往前分配，后面的变量在高字节，前面的变量在低字节
- **间隔规则**：中间的间隔由数字变量的类型决定
  - `int` 类型：间隔双字（4 个字节）

**示例**：`int x[]={1,2,3,4}`
```
VAR_18 ; x 数组的首地址，即 1 的地址
VAR_14
VAR_10
VAR_C  ; 4 的位置
```

### 5.2 指针定义与赋值
- **内存分配**：在 32 位系统中，指针默认分配 4 个字节的内存

**指针赋值示例**：将 `int` 数组 `x` 的地址赋给指针 `a`
```asm
mov eax, [ebp+var_C]        ; 获取数组元素地址
mov [ebp+var_34], eax       ; 赋值给指针 a（假设指针 a 被分配到 var_34）
```

### 5.3 字符串与字符数组的区别

#### 字符串特点
- **内存分配**：只分配一个占 4 字节内存的字符串地址变量和 1 个字节的终止符 `\0`
- **存储方式**：字符串地址变量指向数据段的真正字符串
- **地址分布**：地址在低字节，终止符在高字节
- **空间占用**：无论字符串多长，都只分配 5 个字节的空间

#### 字符数组特点
- **内存分配**：按实际长度分配内存空间
- **空间占用**：长度为 10 的字符数组需要分配 10 个字节的空间

#### 区别示例
**字符串定义**：`char s[]="1234"`
```asm
VAR_28 ; 字符串地址变量的地址
VAR_24 ; 终止符的地址
mov eax, ds:dworld_xxxx    ; 真正数据段里面的字符串
mov [bp+var_28], eax
mov cl, ds:byte_xxxx       ; 指向终止符
mov [bp+var_24], cl
```

**字符数组定义**：`char x[]={'1','2','3','4'}`
```asm
VAR_31 ; 1
VAR_32 ; 2
VAR_33 ; 3
VAR_34 ; 4
```

## 6. 多维数组

### 6.1 内存分配特点
- **等效性**：多维数组可以等效为一维数组
- **分配方式**：按一维数组的内存分配方式进行

**示例**：`int x[2][3]={{1,2,3},{4,5,6}}`
- **等价于**：`int x[]={1,2,3,4,5,6}`
- **地址访问**：`x[1]` 等价于取 `{4,5,6}` 的首地址