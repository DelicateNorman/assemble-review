# 汇编语言程序设计期末考试试题（三）- 标准答案

**考试时间：** 120分钟
**总分：** 100分

---

## 一、单选题（10道题，每题2分，共20分）

1. **(C)** DF（方向标志）属于控制标志，用于控制串操作指令的地址变化方向。
2. **(B)** LEA指令将有效地址装入寄存器，SI = BX + DI + 4的值。
3. **(B)** ADD指令是算术运算指令，会影响所有状态标志位（CF、ZF、SF、OF、AF、PF）。
4. **(B)** CMPSW比较两个字，如果相等则ZF=1，不相等则ZF=0。
5. **(B)** DUP操作符用于重复定义数据，如 `DB 5 DUP(0)` 定义5个字节为0。
6. **(B)** 跳转表+JMP间接寻址是实现多分支转移的最有效方式。
7. **(B)** NEG指令对0求补的结果是0，但会产生借位，所以CF=1。
8. **(A)** .CODE伪指令后面可以跟段名参数，用于指定代码段的名称。
9. **(B)** PE文件头包含DOS存根和PE签名，这是PE文件格式的重要特征。
10. **(B)** 在反汇编分析中，CALL/RET指令对是识别函数边界的重要依据。

---

## 二、填空题（10个，每空2分，共20分）

1. 陷阱（或单步），调试（或单步执行）
2. FFFF，0000
3. 清零（或屏蔽），位掩码
4. 类型（字节数），总字节数
5. 1，计数器减到0
6. 返回，返回
7. 段，节区
8. 输入，输出（或显示）
9. 数据，程序（或控制）
10. 指令，寄存器

---

## 三、指令正确与错误判断题（5条指令，每条2分，共10分）

1. `CMP [BX], [SI]`
   - 判断：**错误**
   - 错误原因：两个操作数都是存储器操作数，8086不允许两个存储器操作数直接进行比较运算。应改为 `MOV AX, [SI]; CMP [BX], AX` 或 `MOV AL, [SI]; CMP [BX], AL`。

2. `SAR AX, 4`
   - 判断：**正确**
   - 错误原因：无错误，SAR指令支持8位或16位寄存器操作，当移位次数大于1时，移位次数可以放在CL寄存器中或直接使用立即数（在8086中，当移位次数为1时可以直接写立即数）。

3. `MUL WORD PTR [BX]`
   - 判断：**正确**
   - 错误原因：无错误，这是合法的无符号字乘法指令，AX × [BX]，结果在DX:AX中。

4. `JGE FAR PTR label`
   - 判断：**错误**
   - 错误原因：条件转移指令（JGE）只能是段内转移（短转移或近转移），不能是段间转移（FAR）。需要先JGE到近处，再用JMP FAR PTR进行段间转移。

5. `LEA AX, [1234H]`
   - 判断：**错误**
   - 错误原因：LEA指令用于装入有效地址，但[1234H]是直接寻址，其有效地址就是1234H。在这种情况下，应该使用 `MOV AX, 1234H` 而不是LEA指令。LEA通常用于复杂的地址表达式，如 `LEA AX, [BX+SI+4]`。

---

## 四、简答题（2题，每题8分，共16分）

### 1. 请简述8086CPU的标志寄存器FLAGS中各个标志位的分类和功能。

**答案：**

8086CPU的标志寄存器FLAGS共16位，包含6个状态标志和3个控制标志：

**（1）状态标志位（反映运算结果的状态）：**

- **CF（Carry Flag）进位标志**：
  - 当加法运算产生进位或减法运算产生借位时置1
  - 用于多精度算术运算和循环移位操作

- **ZF（Zero Flag）零标志**：
  - 当运算结果为0时置1，否则置0
  - 用于判断运算结果是否为零

- **SF（Sign Flag）符号标志**：
  - 当运算结果为负数时置1（最高位为1）
  - 用于判断有符号数的正负

- **OF（Overflow Flag）溢出标志**：
  - 当有符号数运算结果超出表示范围时置1
  - 用于检测有符号数运算是否溢出

- **PF（Parity Flag）奇偶标志**：
  - 当运算结果中1的个数为偶数时置1，奇数时置0
  - 用于数据传输错误检测

- **AF（Auxiliary Carry Flag）辅助进位标志**：
  - 当加法运算中低4位向高4位有进位时置1
  - 用于BCD码算术运算调整

**（2）控制标志位（控制处理器操作方式）：**

- **DF（Direction Flag）方向标志**：
  - DF=0时，串操作指令地址递增
  - DF=1时，串操作指令地址递减
  - 由CLD/STD指令控制

- **IF（Interrupt Flag）中断标志**：
  - IF=1时，允许响应外部中断
  - IF=0时，屏蔽外部中断
  - 由CLI/STI指令控制

- **TF（Trap Flag）陷阱标志**：
  - TF=1时，CPU每执行一条指令就产生单步中断
  - 用于程序调试和单步执行
  - 由调试程序设置

### 2. 请简述PE文件和ELF文件格式的主要区别，以及在反汇编分析中的意义。

**答案：**

**（1）PE文件和ELF文件格式的主要区别：**

**PE（Portable Executable）文件格式：**
- **平台**：主要用于Windows操作系统
- **文件结构**：DOS存根 + PE头 + 节区表 + 各个节区
- **头部结构**：包含DOS头、PE签名、文件头、可选头
- **节区组织**：代码段(.text)、数据段(.data)、资源段(.rsrc)等
- **重定位**：支持基址重定位和导入/导出表
- **调试信息**：通常在单独的调试文件中

**ELF（Executable and Linkable Format）文件格式：**
- **平台**：主要用于Linux/Unix系统
- **文件结构**：ELF头 + 程序头表 + 节区头表 + 各个节区
- **头部结构**：ELF标识头、程序头表、节区头表
- **节区组织**：.text、.data、.bss、.symtab、.strtab等
- **重定位**：支持符号重定位和动态链接
- **调试信息**：通常包含在.debug节区中

**主要区别总结：**
- **字节序**：PE通常小端序，ELF支持大小端序
- **头部结构**：PE有DOS存根，ELF没有
- **调试信息**：PE分离存储，ELF内嵌存储
- **动态链接**：ELF的机制更为灵活

**（2）在反汇编分析中的意义：**

**PE文件分析意义：**
- **入口点识别**：通过可选头找到程序入口
- **导入函数分析**：通过导入表识别外部函数调用
- **资源分析**：分析.rsrc节区获取资源信息
- **基址重定位**：理解程序在内存中的加载过程
- **恶意代码检测**：PE格式常被恶意软件利用

**ELF文件分析意义：**
- **符号表分析**：通过.symtab获取函数和变量信息
- **动态链接分析**：理解动态库的加载和调用机制
- **调试信息利用**：.debug节区提供丰富的调试信息
- **代码优化分析**：理解编译器的优化策略
- **漏洞研究**：ELF格式常见于Linux漏洞研究

**反汇编分析的通用意义：**
- **函数边界识别**：通过文件格式信息确定函数起始位置
- **数据引用分析**：识别全局变量和字符串常量
- **控制流重建**：基于文件格式信息重建程序逻辑
- **安全分析**：识别潜在的恶意行为和漏洞模式

---

## 五、程序阅读题（4段代码，每题5分，共20分）

### 1. 数据统计程序

**填空答案：**
- mov di, count
- cmp
- mov zero, dl

**代码段作用：**
该程序段统计数组numbers中正数、负数和零的个数。程序遍历6个数据元素，分别统计其中正数个数存入positive，负数个数存入negative，零的个数存入zero。最终统计结果：正数3个(10,20,15)，负数2个(-5,-8)，零1个(0)。

### 2. 位操作程序

**填空答案：**
- mov al, value
- test
- mov result, 0

**代码段作用：**
该程序段测试字节变量value的第3位（从0开始计数）是否为1。程序使用TEST指令进行位测试，如果第3位为1则result=1，否则result=0。value=0F5H=11110101B，第3位（值为8）为1，所以result=1。

### 3. 字符转换程序

**填空答案：**
- string
- sub
- dx

**代码段作用：**
该程序段将字符串"Assembly Language"中的小写字母转换为大写字母。程序遍历每个字符，如果是小写字母('a'-'z')则减去32（20H）转换为大写字母。转换后显示结果：ASSEMBLY LANGUAGE。

### 4. 数组搜索程序

**填空答案：**
- target
- array[cx]
- mov ah, 2

**代码段作用：**
该程序段在数组array中线性搜索目标值56。程序逐个比较数组元素，找到目标值时显示其索引，搜索完整个数组未找到则显示"未找到"。数组为12,34,56,78,90，目标56的索引为2（从0开始），所以找到并显示索引2。

---

## 六、程序设计题（14分）

**参考答案：**

```assembly
; 简单计算器程序：两个8位无符号数加法
.model small
.stack 100h
.data
    msg1    db '请输入第一个数字(0-9): $'
    msg2    db 0dh,0ah,'请输入第二个数字(0-9): $'
    msg3    db 0dh,0ah,'计算结果: $'
    msg4    db 0dh,0ah,'有进位$'
    msg5    db 0dh,0ah,'无进位$'
    num1    db ?
    num2    db ?
    sum     db ?
    carry   db ?

.code
startup
    mov ax, @data
    mov ds, ax

    ; 输入第一个数字
    mov dx, offset msg1
    mov ah, 9
    int 21h
    mov ah, 1
    int 21h
    sub al, '0'
    mov num1, al

    ; 输入第二个数字
    mov dx, offset msg2
    mov ah, 9
    int 21h
    mov ah, 1
    int 21h
    sub al, '0'
    mov num2, al

    ; 计算加法
    mov al, num1
    add al, num2
    mov sum, al
    mov carry, 0
    jnc no_carry
    mov carry, 1

no_carry:
    ; 显示结果
    mov dx, offset msg3
    mov ah, 9
    int 21h

    mov dl, sum
    add dl, '0'
    mov ah, 2
    int 21h

    ; 显示进位信息
    cmp carry, 1
    jne show_no_carry
    mov dx, offset msg4
    jmp display_carry

show_no_carry:
    mov dx, offset msg5

display_carry:
    mov ah, 9
    int 21h

    exit 0
end
```

**评分标准：**
- 程序结构完整（简化段定义格式）：2分
- 用户输入功能正确：3分
- 加法计算逻辑正确：3分
- 进位判断和处理正确：3分
- 结果显示功能正确：3分

---

**总分：100分**