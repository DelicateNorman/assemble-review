# 第三章 汇编语言程序格式重点题目解答

## 注意事项
根据文档内容，第三章只包含到3.10题目，**题目3.21不存在**。本文档重点解答3.7、3.8、3.9、3.10题目。

---

## 题目3.7 - 错误语句分析

**题目**：假设 myword 是一个字变量, mybyte1 和 mybyte2 是 2 个字节变量, 指出下列语句中的错误原因。

### 解答：

**(1) mov byte ptr [bx], 1000**
- **错误原因**：数据类型不匹配
- **详细分析**：目标操作数是字节类型(byte ptr)，但源操作数1000是一个字类型数值(1000 = 03E8H)，超出字节范围(0-255)
- **正确写法**：`mov word ptr [bx], 1000` 或 `mov byte ptr [bx], 1000 and 0FFH`

**(2) mov bx, offset myword[si]**
- **错误原因**：offset操作符使用不当
- **详细分析**：offset操作符只能用于直接变量名，不能用于带有寄存器相对寻址的表达式
- **正确写法**：`mov bx, offset myword` 然后 `add bx, si` 或使用 `lea bx, myword[si]`

**(3) cmp mybyte1, mybyte2**
- **错误原因**：内存操作数不能同时作为源操作数和目的操作数
- **详细分析**：比较指令不能同时使用两个内存操作数，至少有一个必须是寄存器
- **正确写法**：
  ```asm
  mov al, mybyte1
  cmp al, mybyte2
  ```

**(4) mov al, mybyte1+mybyte2**
- **错误原因**：地址表达式不能使用算术加法
- **详细分析**：mybyte1+mybyte2试图将两个变量的地址相加，这不是合法的地址表达式
- **正确意图**：如果要实现数值相加，应该：
  ```asm
  mov al, mybyte1
  add al, mybyte2
  ```

**(5) sub al, myword**
- **错误原因**：操作数类型不匹配
- **详细分析**：AL是8位寄存器，myword是16位字变量，类型不匹配
- **正确写法**：`sub ax, myword` 或 `sub al, byte ptr myword`

**(6) jnz myword**
- **错误原因**：跳转目标必须是标号，不能是变量名
- **详细分析**：条件跳转指令的目标必须是代码段中的标号，不能是数据段中的变量
- **正确用法**：跳转到代码段中定义的标号，如 `jnz label_name`

---

## 题目3.8 - AND操作符区别

**题目**：OPR1 是一个常量，问下列语句中两个 AND 操作有什么区别？

```asm
and al, opr1 and 0feh
```

### 解答：

**第一个 AND**：**处理器指令**
- 是8086 CPU的指令助记符
- 在程序**运行时**执行
- 功能：对AL寄存器的值与立即数进行按位与运算
- 结果保存在AL寄存器中

**第二个 AND**：**MASM操作符**
- 是汇编程序的运算符
- 在程序**汇编时**计算
- 功能：计算常量opr1与0FEH的按位与结果
- 产生一个立即数作为第一个AND指令的源操作数

**执行过程**：
1. **汇编阶段**：计算 `opr1 and 0feh` 的值，得到立即数
2. **运行阶段**：执行 `and al, 立即数` 指令

**举例**：
```asm
opr1 equ 0a5h
; 汇编时计算：0a5h and 0feh = 0a4h
; 汇编后的指令：and al, 0a4h
```

---

## 题目3.9 - 数值表达式计算

**题目**：给出下列语句中，指令立即数（数值表达式）的值：

### 解答：

**(1) mov al, 23h and 45h or 67h**
- **计算过程**：23H AND 45H = 01H，然后 01H OR 67H = 67H
- **结果**：67H

**(2) mov ax, 1234h / 16 + 10h**
- **计算过程**：1234H ÷ 16 = 123H，然后 123H + 10H = 133H
- **结果**：133H

**(3) mov ax, not (65535 xor 1234h)**
- **计算过程**：65535 XOR 1234H = EDCBH，然后 NOT EDCBH = 1234H
- **结果**：1234H

**(4) mov al, low 1234h or high 5678h**
- **计算过程**：LOW 1234H = 34H，HIGH 5678H = 56H，然后 34H OR 56H = 76H
- **结果**：76H

**(5) mov ax, 23h shl 4**
- **计算过程**：23H 左移4位 = 230H
- **结果**：230H

**(6) mov ax, 1234h shr 6**
- **计算过程**：1234H 右移6位 = 48H
- **结果**：48H

**(7) mov al, 'a' and (not('a' - 'a'))**
- **计算过程**：'a' - 'a' = 0，NOT 0 = 0FFH，然后 'a'(61H) AND 0FFH = 61H
- **结果**：61H（字符'a'的ASCII码）

**(8) mov al, 'h' or 00100000b**
- **计算过程**：'h'(68H) OR 20H = 68H（小写'h'本身第5位就是1）
- **结果**：68H

**(9) mov ax, (76543 lt 32768) xor 7654h**
- **计算过程**：76543 < 32768 为假(0)，然后 0 XOR 7654H = 7654H
- **结果**：7654H

---

## 题目3.10 - 内存分配可视化

**题目**：画图说明下列语句分配的存储空间及初始化的数据值：

```asm
byte_var db 'abc', 10, 10h, 'ef', 3 dup(-1, ?, 3 dup(4))
```

### 解答：

**内存分配图**（假设从偏移地址0000H开始）：

```
偏移地址  数据值    说明
--------  ------  --------------------
0000H      61H    'a' (第一个字符)
0001H      62H    'b' (第二个字符)
0002H      63H    'c' (第三个字符)
0003H      0AH    十进制数10
0004H      10H    十六进制数10H
0005H      65H    'e' (第四个字符)
0006H      66H    'f' (第五个字符)

第一个dup块开始：
0007H      FFH    -1 (第一个dup的第一个元素)
0008H      ??     ? (第一个dup的第二个元素)
0009H      04H    4 (第一个dup的嵌套dup的第一个4)
000AH      04H    4 (第一个dup的嵌套dup的第二个4)
000BH      04H    4 (第一个dup的嵌套dup的第三个4)

第二个dup块开始：
000CH      FFH    -1 (第二个dup的第一个元素)
000DH      ??     ? (第二个dup的第二个元素)
000EH      04H    4 (第二个dup的嵌套dup的第一个4)
000FH      04H    4 (第二个dup的嵌套dup的第二个4)
0010H      04H    4 (第二个dup的嵌套dup的第三个4)

第三个dup块开始：
0011H      FFH    -1 (第三个dup的第一个元素)
0012H      ??     ? (第三个dup的第二个元素)
0013H      04H    4 (第三个dup的嵌套dup的第一个4)
0014H      04H    4 (第三个dup的嵌套dup的第二个4)
0015H      04H    4 (第三个dup的嵌套dup的第三个4)
```

**总字节数**：22字节

**详细分析**：
1. **'abc'**：3个字节，存储字符'a'(61H)、'b'(62H)、'c'(63H)
2. **10**：1个字节，存储十进制数10(0AH)
3. **10h**：1个字节，存储十六进制数10H
4. **'ef'**：2个字节，存储字符'e'(65H)、'f'(66H)
5. **3 dup(-1, ?, 3 dup(4))**：重复3次，每次包含：
   - **-1**：1字节，存储FFH（-1的补码表示）
   - **?**：1字节，未初始化
   - **3 dup(4)**：3字节，都存储04H

---

## 总结

这些题目涵盖了汇编语言程序设计的重要概念：

1. **数据类型匹配**：理解字节、字操作数的区别
2. **操作符与指令的区别**：汇编时计算 vs 运行时执行
3. **数值表达式**：掌握MASM运算符的使用和优先级
4. **内存分配**：理解DUP操作符和数据存储方式

这些知识点对于编写正确的汇编程序至关重要。